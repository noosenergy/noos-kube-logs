# All container logs are maintained as symlinks onto the node
<source>
  @type tail
  @label @KUBERNETES_LOG
  path /var/log/containers/*.log
  pos_file /var/log/fluentd-containers.log.pos
  read_from_head true
  <parse>
    @type json
  </parse>
  tag kubernetes.*
</source>

<label @KUBERNETES_LOG>
  <filter kubernetes.**>
    @type kubernetes_metadata
  </filter>
  # Don't emit logs for fluentd pods
  <match kubernetes.var.log.containers.**fluentd**.log>
    @type null
  </match>
  # Don't emit logs for all kube namespaces
  <match kubernetes.var.log.containers.**kube-**.log>
    @type null
  </match>
  # All other container logs
  <match kubernetes.**>
    @type loggly
    loggly_url "#{ENV['FLUENTD__LOGGLY_URL']}"
    # Upload events regularly
    flush_interval 10s
  </match>
</label>
